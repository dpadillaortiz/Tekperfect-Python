#! /usr/bin/python3

from pymetasploit3.msfrpc import *

EXPLOIT_FILE = 'Console-Output/all-exploits.txt'

PAYLOAD_FILE = 'Console-Output/all-payloads.txt'

class MSFuncs:
    
    def __init__(self, password):
        self.password = password
        self.client = MsfRpcClient(self.password, port=55552, ssl=False)

    def exploitsToFile(self):
        exploits = self.client.modules.exploits
        with open(EXPLOIT_FILE, 'w') as data:
            for exploit in exploits:
                data.write(exploit)
                data.write('\n')

    def payloadsToFile(self):
        payloads = self.client.modules.payloads
        with open(PAYLOAD_FILE, 'w') as data:
            for payload in payloads:
                data.write(payload)
                data.write('\n')
    
    def getTargetPayloads(self, exploit):
        exploit = self.client.modules.use('exploit', exploit)
        return exploit.targetpayloads()
    
    def onlyRHostPortOptions(self, module, file):
        with open(file, 'r') as data:
            for item in data:
                epModule = self.client.modules.use(module, item.strip('\n'))
                if len(epModule.missing_required) == 2:
                    with open('text.txt', 'w') as f:
                        f.write(item)
                        f.write('\n')






def searchFor(search, file):
    query = []
    with open(file, 'r') as data:
        for item in data:
            if search in item:
                query.append(item.strip('\n'))
    return query

test =MSFuncs('glPeNRqd').onlyRHostPortOptions('payload',PAYLOAD_FILE)

